<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TalkZone</title>
  </head>
  <body>
    <div class="app">
      <div class="servers_block">
        <div class="servers_list" id="servers_list"></div>
      </div>
      <div
        class="flex flex-col items-center justify-between bg-server_components_dg"
      >
        <div class="server_components_block" id="server_components_block"></div>
        <div
          id="in_conversation_things"
          class="w-full h-[60px] flex items-center justify-center hidden bg-[#1A1B1E]"
        >
          <button id="leave_button" onclick="voiceChannelLeave()">
            Покинуть канал
          </button>
        </div>
        <div class="profile">
          <div class="profile_wrapper" id="my_profile"></div>
        </div>
        <video class="hidden" id="remoteVideo" autoplay playsinline></video>
        <audio class="hidden" id="remoteAudio" autoplay></audio>
      </div>
      <div
        id="authModal"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden"
      >
        <div class="bg-gray-800 text-white p-6 rounded-lg w-96">
          <!-- Заголовок и кнопки переключения -->
          <div class="flex justify-between mb-4">
            <button id="loginTab" onclick="showLogin()" class="auth-tab-active">
              Вход
            </button>
            <button
              id="registerTab"
              onclick="showRegister()"
              class="auth-tab-inactive"
            >
              Регистрация
            </button>
          </div>

          <!-- Форма для входа -->
          <form id="loginForm" class="space-y-4" onsubmit="handleLogin(event)">
            <div>
              <label for="loginUsername" class="block text-sm"
                >Имя пользователя</label
              >
              <input
                type="text"
                id="loginUsername"
                name="username"
                autocomplete="username"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <div>
              <label for="loginPassword" class="block text-sm">Пароль</label>
              <input
                type="password"
                id="loginPassword"
                name="password"
                autocomplete="current-password"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <button
              type="submit"
              class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded-md"
            >
              Войти
            </button>
          </form>

          <!-- Форма для регистрации -->
          <form
            id="registerForm"
            class="space-y-4 hidden"
            onsubmit="handleRegister(event)"
          >
            <div>
              <label for="registerUsername" class="block text-sm"
                >Имя пользователя</label
              >
              <input
                type="text"
                id="registerUsername"
                name="username"
                autocomplete="username"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <div>
              <label for="registerPassword" class="block text-sm">Пароль</label>
              <input
                type="password"
                id="registerPassword"
                name="password"
                autocomplete="new-password"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <div>
              <label for="registerConfirmPassword" class="block text-sm"
                >Подтвердите пароль</label
              >
              <input
                type="password"
                id="registerConfirmPassword"
                name="confirmPassword"
                autocomplete="new-password"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <button
              type="submit"
              class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded-md"
            >
              Зарегистрироваться
            </button>
          </form>

          <!-- Кнопка для входа как гость -->
          <button
            onclick="guestLoginHandler()"
            class="mt-4 w-full bg-gray-600 hover:bg-gray-700 p-2 rounded-md text-sm"
          >
            Войти как гость
          </button>
        </div>
      </div>
      <div
        id="profileModal"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden"
      >
        <div class="bg-gray-800 text-white p-6 rounded-lg w-96">
          <!-- Заголовок -->
          <h2 class="text-xl font-semibold mb-4">Смена ника и аватара</h2>

          <!-- Форма для смены ника -->
          <form
            id="nicknameForm"
            class="space-y-4"
            onsubmit="handleNicknameChange(event)"
          >
            <div>
              <label for="change_nickname" class="block text-sm">Новый ник</label>
              <input
                type="text"
                id="change_nickname"
                name="change_nickname"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <!-- Кнопка сохранения изменений для ника -->
            <button
              type="button"
              onclick="handleNicknameChange(event)"
              class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded-md"
            >
              Сохранить ник
            </button>
          </form>

          <!-- Форма для смены аватара -->
          <form
            id="avatarForm"
            class="space-y-4 mt-4"
            onsubmit="handleAvatarChange(event)"
          >
            <div>
              <label for="change_avatar" class="block text-sm">Новый аватар</label>
              <input
                type="file"
                id="change_avatar"
                name="change_avatar"
                accept="image/*"
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none file:bg-gray-600 file:text-white file:border-none file:rounded-md file:px-4 file:py-2 hover:file:bg-gray-700"
              />
            </div>
            <!-- Кнопка сохранения изменений для аватара -->
            <button
              type="button"
              onclick="handleAvatarChange(event)"
              class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded-md"
            >
              Сохранить аватар
            </button>
          </form>

          <!-- Кнопка отмены -->
          <button
            onclick="closeProfileModal()"
            class="mt-4 w-full bg-gray-600 hover:bg-gray-700 p-2 rounded-md text-sm"
          >
            Отмена
          </button>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
    <script type="module" src="/src/handlers/mainHandler.ts"></script>
    <script>
      function toggleCategory(categoryId) {
        const channelList = document.querySelector(
          `#channel_list_${categoryId}`,
        );
        const toggleIcon = document.querySelector(`#toggle_icon_${categoryId}`);

        if (
          channelList.style.display === 'none' ||
          channelList.style.display === ''
        ) {
          channelList.style.display = 'block';
          toggleIcon.textContent = '-';
        } else {
          channelList.style.display = 'none';
          toggleIcon.textContent = '+';
        }
      }

      function closeProfileModal() {
        const profileModal = document.getElementById('profileModal');
        if (profileModal) {
          profileModal.classList.add('hidden');
        }
      }

      function openProfileModal() {
        const profileModal = document.getElementById('profileModal');
        if (profileModal) {
          profileModal.classList.remove('hidden');
        }
      }
    </script>
  </body>
</html>
