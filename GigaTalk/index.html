<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TalkZone</title>
  </head>
  <body>
    <div class="app">
      <div class="servers_block">
        <div class="servers_list" id="servers_list"></div>
        <div class="settings" id="settings" onclick="openSettingsModal()"></div>
      </div>
      <div
        class="flex flex-col items-center justify-between bg-server_components_dg"
      >
        <div class="server_components_block" id="server_components_block"></div>
        <div
          id="in_conversation_things"
          class="w-full h-[60px] flex items-center justify-center hidden bg-[#1A1B1E]"
        >
          <button id="leave_button" onclick="voiceChannelLeave()">
            Покинуть канал
          </button>
        </div>
        <div class="profile">
          <div class="profile_wrapper" id="my_profile"></div>
        </div>
      </div>
      <div class="media_tracks" id="media_tracks_list">
        <!-- <video class="remoteVideo" id="" autoplay playsinline></video>
        <audio class="remoteAudio" id="" autoplay></audio> -->
      </div>
      <div
        id="authModal"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden"
      >
        <div class="bg-gray-800 text-white p-6 rounded-lg w-96">
          <!-- Заголовок и кнопки переключения -->
          <div class="flex justify-between mb-4">
            <button id="loginTab" onclick="showLogin()" class="auth-tab-active">
              Вход
            </button>
            <button
              id="registerTab"
              onclick="showRegister()"
              class="auth-tab-inactive"
            >
              Регистрация
            </button>
          </div>

          <!-- Форма для входа -->
          <form id="loginForm" class="space-y-4" onsubmit="handleLogin(event)">
            <div>
              <label for="loginUsername" class="block text-sm"
                >Имя пользователя</label
              >
              <input
                type="text"
                id="loginUsername"
                name="username"
                autocomplete="username"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <div>
              <label for="loginPassword" class="block text-sm">Пароль</label>
              <input
                type="password"
                id="loginPassword"
                name="password"
                autocomplete="current-password"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <button
              type="submit"
              class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded-md"
            >
              Войти
            </button>
          </form>

          <!-- Форма для регистрации -->
          <form
            id="registerForm"
            class="space-y-4 hidden"
            onsubmit="handleRegister(event)"
          >
            <div>
              <label for="registerUsername" class="block text-sm"
                >Имя пользователя</label
              >
              <input
                type="text"
                id="registerUsername"
                name="username"
                autocomplete="username"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <div>
              <label for="registerPassword" class="block text-sm">Пароль</label>
              <input
                type="password"
                id="registerPassword"
                name="password"
                autocomplete="new-password"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <div>
              <label for="registerConfirmPassword" class="block text-sm"
                >Подтвердите пароль</label
              >
              <input
                type="password"
                id="registerConfirmPassword"
                name="confirmPassword"
                autocomplete="new-password"
                required
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none"
              />
            </div>
            <button
              type="submit"
              class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded-md"
            >
              Зарегистрироваться
            </button>
          </form>

          <!-- Кнопка для входа как гость -->
          <button
            onclick="guestLoginHandler()"
            class="mt-4 w-full bg-gray-600 hover:bg-gray-700 p-2 rounded-md text-sm"
          >
            Войти как гость
          </button>
        </div>
      </div>
      <div
        id="profileModal"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden"
      >
        <div class="bg-gray-800 text-white p-6 rounded-lg w-96">
          <h2 class="text-xl font-semibold mb-4">Поменять аватарку</h2>

          <form
            id="avatarForm"
            class="space-y-4 mt-4"
            onsubmit="handleAvatarChange(event)"
          >
            <div>
              <label for="change_avatar" class="block text-sm"
                >Новый аватар</label
              >
              <input
                type="file"
                id="change_avatar"
                name="change_avatar"
                accept="image/*"
                class="w-full p-2 mt-1 bg-gray-700 rounded-md focus:outline-none file:bg-gray-600 file:text-white file:border-none file:rounded-md file:px-4 file:py-2 hover:file:bg-gray-700"
              />
            </div>

            <!-- Предварительный просмотр изображения -->
            <div class="mt-4">
              <label class="block text-sm mb-2"
                >Предварительный просмотр:</label
              >
              <div class="flex justify-center">
                <img
                  id="previewImage"
                  class="w-32 h-32 rounded-full object-cover hidden"
                  src=""
                  alt="Предварительный просмотр"
                />
              </div>
            </div>

            <button
              type="button"
              onclick="handleAvatarChange(event)"
              class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded-md"
            >
              Сохранить аватар
            </button>
          </form>

          <button
            onclick="closeProfileModal()"
            class="mt-4 w-full bg-gray-600 hover:bg-gray-700 p-2 rounded-md text-sm"
          >
            Отмена
          </button>
        </div>
      </div>
      <div
        id="settingsModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
      >
        <div class="bg-gray-800 text-white p-6 rounded-lg w-96">
          <h2 class="text-xl font-semibold mb-4">Настройки пользователя</h2>

          <!-- Ползунок для громкости -->
          <div class="mb-4">
            <label for="volume" class="block text-sm mb-2">Громкость</label>
            <input type="range" id="volume" min="0" max="100" class="w-full" />
          </div>

          <!-- Выбор микрофона -->
          <div class="mb-[60px]">
            <label for="microphone" class="block text-sm mb-2"
              >Выбор микрофона</label
            >
            <select id="microphone" class="w-full p-2 bg-gray-700 rounded-md">
              <option>Микрофон 1</option>
              <option>Микрофон 2</option>
              <option>Микрофон 3</option>
            </select>
          </div>

          <!-- Кнопка выхода -->
          <button
            onclick="logOut()"
            class="w-full bg-red-600 hover:bg-red-700 p-2 rounded-md mb-4"
          >
            Выйти из аккаунта
          </button>

          <!-- Кнопка закрытия -->
          <button
            onclick="closeSettingsModal()"
            class="w-full bg-gray-600 hover:bg-gray-700 p-2 rounded-md"
          >
            Закрыть
          </button>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
    <script type="module" src="/src/handlers/mainHandler.ts"></script>
    <script>
      function toggleCategory(categoryId) {
        const channelList = document.querySelector(
          `#channel_list_${categoryId}`,
        );
        const toggleIcon = document.querySelector(`#toggle_icon_${categoryId}`);

        if (
          channelList.style.display === 'none' ||
          channelList.style.display === ''
        ) {
          channelList.style.display = 'block';
          toggleIcon.textContent = '-';
        } else {
          channelList.style.display = 'none';
          toggleIcon.textContent = '+';
        }
      }

      function openProfileModal() {
        const profileModal = document.getElementById('profileModal');
        if (profileModal) {
          profileModal.classList.remove('hidden');
        }
      }
      document
        .getElementById('change_avatar')
        .addEventListener('change', previewImage);

      function previewImage(event) {
        const file = event.target.files[0];
        const previewImage = document.getElementById('previewImage');

        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            previewImage.src = e.target.result;
            previewImage.classList.remove('hidden');
          };
          reader.readAsDataURL(file);
        } else {
          previewImage.src = '';
          previewImage.classList.add('hidden');
        }
      }

      function openSettingsModal() {
        document.getElementById('settingsModal').classList.remove('hidden');
      }

      function closeSettingsModal() {
        document.getElementById('settingsModal').classList.add('hidden');
      }
    </script>
  </body>
</html>
